<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>паб саб  чат</title>
</head>
<body>
    <h1>чат</h1>
    <div id="messagesList" style="border: 1px solid gray; height: 250px; width: 400px; overflow-y: scroll; padding: 10px;"></div>
    <br>
    <input id="userNameInput" type="text" placeholder="Имя">
    <input id="userMessageInput" type="text" placeholder="Сообщение">
    <button onclick="publishMessage()">Отправить в PubSub</button>
    <script>
        const serverA_Url = "http://localhost:8003";
        const serverB_Url = "http://localhost:8004";
        async function publishMessage() {
            const name = document.getElementById("userNameInput").value;
            const text = document.getElementById("userMessageInput").value;
            await fetch(serverA_Url + "/publish-message", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userName: name, userMessage: text })
            });
            document.getElementById("userMessageInput").value = "";
        }
        async function updateHistory() {
            const response = await fetch(serverB_Url + "/get-history");
            const data = await response.json();
            const list = document.getElementById("messagesList");
            
            list.innerHTML = "";
            for (let i = 0; i < data.length; i++) {
                const messageDiv = document.createElement("div");
                messageDiv.innerText = data[i];
                list.appendChild(messageDiv);
            }
        }
        setInterval(updateHistory, 1000);
    </script>
</body>
</html>